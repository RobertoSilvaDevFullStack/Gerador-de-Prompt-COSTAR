<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSTAR Prompt Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            color: white;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 10px solid white;
            transform: translateX(-50%);
        }

        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #667eea;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section i {
            color: #764ba2;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        }

        .generated-prompt {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            position: relative;
            animation: slideInUp 0.5s ease-out;
        }

        .generated-prompt h4 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .prompt-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
        }

        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #5a6fd8;
            transform: scale(1.05);
        }

        /* Loading animation */
        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Analysis styles */
        .analysis-card {
            margin-top: 30px;
            padding: 20px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.1);
        }

        .metric-card {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
        }

        .section-header {
            color: #333;
            margin: 0 0 10px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge-success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-warning {
            background: linear-gradient(135deg, #FF9800, #f57c00);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .saved-prompts {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .prompt-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .prompt-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .prompt-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .prompt-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .prompt-card-actions {
            display: flex;
            gap: 10px;
        }

        .prompt-card-actions button {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading i {
            font-size: 3rem;
            color: #667eea;
            animation: spin 2s linear infinite;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .template-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .template-card:hover {
            transform: translateY(-3px);
            border-color: #667eea;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .template-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .template-card p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .tab-content {
                padding: 20px;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }

            .saved-prompts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-magic"></i> COSTAR Prompt Generator</h1>
            <p>Crie prompts estruturados e profissionais seguindo a metodologia COSTAR</p>
        </div>

        <div class="main-content">
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="generator">
                    <i class="fas fa-pencil-alt"></i> Gerador
                </button>
                <button class="nav-tab" data-tab="templates">
                    <i class="fas fa-layer-group"></i> Templates
                </button>
                <button class="nav-tab" data-tab="saved">
                    <i class="fas fa-bookmark"></i> Salvos
                </button>
            </div>

            <!-- Generator Tab -->
            <div class="tab-content active" id="generator">
                <form id="promptForm">
                    <div class="form-section">
                        <h3><i class="fas fa-info-circle"></i> Context (Contexto)</h3>
                        <div class="form-group">
                            <label for="context">Defina o contexto e papel do assistente:</label>
                            <textarea class="form-control" id="context"
                                placeholder="Ex: Voc√™ √© um especialista em marketing digital com 10 anos de experi√™ncia..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-bullseye"></i> Objective (Objetivo)</h3>
                        <div class="form-group">
                            <label for="objective">Descreva claramente o objetivo desejado:</label>
                            <textarea class="form-control" id="objective"
                                placeholder="Ex: Criar uma campanha publicit√°ria para aumentar as vendas em 30%..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-palette"></i> Style (Estilo)</h3>
                        <div class="form-group">
                            <label for="style">Especifique o estilo de escrita ou formato:</label>
                            <textarea class="form-control" id="style"
                                placeholder="Ex: Estilo jornal√≠stico, formal, criativo, t√©cnico..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-comment"></i> Tone (Tom)</h3>
                        <div class="form-group">
                            <label for="tone">Defina o tom da comunica√ß√£o:</label>
                            <textarea class="form-control" id="tone"
                                placeholder="Ex: Profissional, amig√°vel, persuasivo, educativo..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-users"></i> Audience (Audi√™ncia)</h3>
                        <div class="form-group">
                            <label for="audience">Descreva o p√∫blico-alvo:</label>
                            <textarea class="form-control" id="audience"
                                placeholder="Ex: Empres√°rios entre 30-45 anos, interessados em tecnologia..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-clipboard-list"></i> Response (Resposta)</h3>
                        <div class="form-group">
                            <label for="response">Especifique o formato de resposta desejado:</label>
                            <textarea class="form-control" id="response"
                                placeholder="Ex: Lista com 5 itens, texto de 300 palavras, formato de e-mail..."></textarea>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button type="submit" class="btn">
                            <i class="fas fa-magic"></i> Gerar Prompt COSTAR
                        </button>
                        <button type="button" class="btn btn-secondary" id="clearForm">
                            <i class="fas fa-eraser"></i> Limpar Formul√°rio
                        </button>
                    </div>
                </form>

                <div id="generatedPrompt" style="display: none;" class="generated-prompt">
                    <h4><i class="fas fa-check-circle"></i> Prompt Gerado</h4>
                    <button class="copy-btn" id="copyBtn">
                        <i class="fas fa-copy"></i> Copiar
                    </button>
                    <div class="prompt-content" id="promptContent"></div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-success" id="savePrompt">
                            <i class="fas fa-save"></i> Salvar Prompt
                        </button>
                        <button class="btn btn-secondary" id="sendToGemini">
                            <i class="fas fa-robot"></i> Enviar para Gemini
                        </button>
                    </div>
                </div>
            </div>

            <!-- Templates Tab -->
            <div class="tab-content" id="templates">
                <h3><i class="fas fa-layer-group"></i> Templates Prontos</h3>
                <p>Escolha um template para come√ßar rapidamente:</p>

                <div class="template-grid" id="templateGrid">
                    <div class="template-card" data-template="marketing">
                        <h4>Marketing Digital</h4>
                        <p>Template para campanhas de marketing, copywriting e estrat√©gias de vendas</p>
                    </div>
                    <div class="template-card" data-template="content">
                        <h4>Cria√ß√£o de Conte√∫do</h4>
                        <p>Para blogs, artigos, posts em redes sociais e materiais educativos</p>
                    </div>
                    <div class="template-card" data-template="tech">
                        <h4>Desenvolvimento</h4>
                        <p>C√≥digo, documenta√ß√£o t√©cnica e solu√ß√µes de programa√ß√£o</p>
                    </div>
                    <div class="template-card" data-template="business">
                        <h4>Neg√≥cios</h4>
                        <p>Estrat√©gias empresariais, an√°lises e relat√≥rios profissionais</p>
                    </div>
                </div>
            </div>

            <!-- Saved Tab -->
            <div class="tab-content" id="saved">
                <h3><i class="fas fa-bookmark"></i> Prompts Salvos</h3>
                <p>Gerencie seus prompts salvos:</p>

                <div class="saved-prompts" id="savedPrompts">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Carregando prompts salvos...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class COSTARGenerator {
            constructor() {
                this.savedPrompts = JSON.parse(localStorage.getItem('costarPrompts')) || [];
                this.templates = {
                    marketing: {
                        context: "Voc√™ √© um especialista em marketing digital com 10 anos de experi√™ncia em campanhas de alta convers√£o",
                        objective: "Criar uma estrat√©gia de marketing completa para aumentar vendas",
                        style: "Profissional e orientado a resultados, com dados e m√©tricas",
                        tone: "Persuasivo e confiante, mas n√£o agressivo",
                        audience: "Empres√°rios e profissionais de marketing",
                        response: "Plano estruturado com estrat√©gias, t√°ticas e m√©tricas de acompanhamento"
                    },
                    content: {
                        context: "Voc√™ √© um redator criativo e estrat√©gico especializado em conte√∫do engajante",
                        objective: "Produzir conte√∫do de alta qualidade que eduque e engaje o p√∫blico",
                        style: "Criativo, educativo e envolvente",
                        tone: "Amig√°vel e acess√≠vel, mas autoritativo no assunto",
                        audience: "P√∫blico interessado em aprender sobre o tema",
                        response: "Conte√∫do estruturado com introdu√ß√£o, desenvolvimento e conclus√£o clara"
                    },
                    tech: {
                        context: "Voc√™ √© um desenvolvedor s√™nior com expertise em m√∫ltiplas linguagens e frameworks",
                        objective: "Fornecer solu√ß√µes t√©cnicas eficientes e bem documentadas",
                        style: "T√©cnico e preciso, com boas pr√°ticas de programa√ß√£o",
                        tone: "Profissional e did√°tico",
                        audience: "Desenvolvedores e profissionais de TI",
                        response: "C√≥digo funcional com explica√ß√µes e documenta√ß√£o adequada"
                    },
                    business: {
                        context: "Voc√™ √© um consultor empresarial com MBA e experi√™ncia em estrat√©gia corporativa",
                        objective: "Desenvolver an√°lises e estrat√©gias de neg√≥cio eficazes",
                        style: "Anal√≠tico e estruturado, baseado em dados",
                        tone: "Profissional e objetivo",
                        audience: "Executivos e gestores empresariais",
                        response: "Relat√≥rio executivo com an√°lises, recomenda√ß√µes e pr√≥ximos passos"
                    }
                };
                this.initializeEvents();
                this.loadSavedPrompts();
            }

            initializeEvents() {
                // Tab navigation
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
                });

                // Form submission
                document.getElementById('promptForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.generatePrompt();
                });

                // Clear form
                document.getElementById('clearForm').addEventListener('click', () => this.clearForm());

                // Copy button
                document.getElementById('copyBtn').addEventListener('click', () => this.copyPrompt());

                // Save prompt
                document.getElementById('savePrompt').addEventListener('click', () => this.saveCurrentPrompt());

                // Send to Gemini (placeholder)
                document.getElementById('sendToGemini').addEventListener('click', () => this.sendToGemini());

                // Template selection
                document.querySelectorAll('.template-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const template = e.currentTarget.dataset.template;
                        this.loadTemplate(template);
                    });
                });
            }

            switchTab(tabId) {
                // Update tab buttons
                document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');

                if (tabId === 'saved') {
                    this.loadSavedPrompts();
                }
            }

            async generatePrompt() {
                const formData = {
                    contexto: document.getElementById('context').value.trim(),
                    objetivo: document.getElementById('objective').value.trim(),
                    estilo: document.getElementById('style').value.trim(),
                    tom: document.getElementById('tone').value.trim(),
                    audiencia: document.getElementById('audience').value.trim(),
                    resposta: document.getElementById('response').value.trim()
                };

                // Validate form
                const emptyFields = Object.values(formData).filter(value => !value);
                if (emptyFields.length > 0) {
                    this.showAlert('Por favor, preencha todos os campos do formul√°rio.', 'error');
                    return;
                }

                // Show loading
                const loadingMessage = document.createElement('div');
                loadingMessage.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                        <p>Gerando prompt aprimorado com IA...</p>
                    </div>
                `;
                document.getElementById('promptContent').innerHTML = '';
                document.getElementById('promptContent').appendChild(loadingMessage);
                document.getElementById('generatedPrompt').style.display = 'block';

                try {
                    // Call API to generate enhanced prompt
                    const response = await fetch('/api/prompts/preview', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        throw new Error(`Erro na API: ${response.status}`);
                    }

                    const result = await response.json();

                    // Display enhanced prompt
                    document.getElementById('promptContent').innerHTML = `
                        <div style="white-space: pre-line; font-family: monospace; line-height: 1.6;">
                            ${result.prompt_aprimorado}
                        </div>
                        <div style="margin-top: 15px; text-align: right;">
                            <small style="color: #666; font-style: italic;">Gerado em: ${new Date(result.timestamp).toLocaleString('pt-BR')}</small>
                        </div>
                    `;

                    this.showAlert(`Prompt COSTAR gerado com sucesso! (${result.modo})`, 'success');

                } catch (error) {
                    console.error('Erro ao gerar prompt:', error);

                    // Fallback to basic generation
                    const basicPrompt = this.buildCOSTARPrompt({
                        context: formData.contexto,
                        objective: formData.objetivo,
                        style: formData.estilo,
                        tone: formData.tom,
                        audience: formData.audiencia,
                        response: formData.resposta
                    });

                    document.getElementById('promptContent').innerHTML = `
                        <div style="white-space: pre-line; font-family: monospace; line-height: 1.6;">
                            ${basicPrompt}
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
                            <h4 style="margin: 0 0 10px 0; color: #856404;">
                                <i class="fas fa-exclamation-triangle"></i> Modo B√°sico
                            </h4>
                            <p style="margin: 0;">N√£o foi poss√≠vel conectar com a IA. Usando gera√ß√£o b√°sica.</p>
                            <p style="margin: 5px 0 0 0;"><small>Erro: ${error.message}</small></p>
                        </div>
                    `;

                    this.showAlert('Prompt gerado em modo b√°sico (erro na IA)', 'warning');
                }

                // Scroll to generated prompt
                document.getElementById('generatedPrompt').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }

            buildCOSTARPrompt(data) {
                return `**Prompt (COSTAR)**

**Context**
${data.context}

**Objective**
${data.objective}

**Style**
${data.style}

**Tone**
${data.tone}

**Audience**
${data.audience}

**Response**
${data.response}`;
            }

            copyPrompt() {
                const promptContent = document.getElementById('promptContent').textContent;
                navigator.clipboard.writeText(promptContent).then(() => {
                    const btn = document.getElementById('copyBtn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check"></i> Copiado!';
                    btn.style.background = '#28a745';

                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.style.background = '#667eea';
                    }, 2000);
                }).catch(() => {
                    this.showAlert('Erro ao copiar o prompt.', 'error');
                });
            }

            saveCurrentPrompt() {
                const promptContent = document.getElementById('promptContent').textContent;
                const title = prompt('Digite um t√≠tulo para este prompt:') || `Prompt ${Date.now()}`;

                if (title) {
                    const promptObj = {
                        id: Date.now(),
                        title: title,
                        content: promptContent,
                        createdAt: new Date().toLocaleString('pt-BR'),
                        formData: {
                            context: document.getElementById('context').value,
                            objective: document.getElementById('objective').value,
                            style: document.getElementById('style').value,
                            tone: document.getElementById('tone').value,
                            audience: document.getElementById('audience').value,
                            response: document.getElementById('response').value
                        }
                    };

                    this.savedPrompts.unshift(promptObj);
                    localStorage.setItem('costarPrompts', JSON.stringify(this.savedPrompts));
                    this.showAlert('Prompt salvo com sucesso!', 'success');
                }
            }

            loadTemplate(templateName) {
                const template = this.templates[templateName];
                if (template) {
                    document.getElementById('context').value = template.context;
                    document.getElementById('objective').value = template.objective;
                    document.getElementById('style').value = template.style;
                    document.getElementById('tone').value = template.tone;
                    document.getElementById('audience').value = template.audience;
                    document.getElementById('response').value = template.response;

                    this.switchTab('generator');
                    this.showAlert('Template carregado com sucesso!', 'success');
                }
            }

            loadSavedPrompts() {
                const container = document.getElementById('savedPrompts');

                if (this.savedPrompts.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-bookmark" style="font-size: 3rem; margin-bottom: 20px;"></i>
                            <p>Nenhum prompt salvo ainda.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.savedPrompts.map(prompt => `
                    <div class="prompt-card">
                        <h4>${prompt.title}</h4>
                        <p>Criado em: ${prompt.createdAt}</p>
                        <div class="prompt-card-actions">
                            <button class="btn btn-secondary" onclick="app.loadPrompt(${prompt.id})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-success" onclick="app.copyPromptById(${prompt.id})">
                                <i class="fas fa-copy"></i> Copiar
                            </button>
                            <button class="btn btn-danger" onclick="app.deletePrompt(${prompt.id})">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            loadPrompt(id) {
                const prompt = this.savedPrompts.find(p => p.id === id);
                if (prompt) {
                    const formData = prompt.formData;
                    document.getElementById('context').value = formData.context;
                    document.getElementById('objective').value = formData.objective;
                    document.getElementById('style').value = formData.style;
                    document.getElementById('tone').value = formData.tone;
                    document.getElementById('audience').value = formData.audience;
                    document.getElementById('response').value = formData.response;

                    this.switchTab('generator');
                    this.showAlert('Prompt carregado para edi√ß√£o!', 'success');
                }
            }

            copyPromptById(id) {
                const prompt = this.savedPrompts.find(p => p.id === id);
                if (prompt) {
                    navigator.clipboard.writeText(prompt.content).then(() => {
                        this.showAlert('Prompt copiado com sucesso!', 'success');
                    }).catch(() => {
                        this.showAlert('Erro ao copiar o prompt.', 'error');
                    });
                }
            }

            deletePrompt(id) {
                if (confirm('Tem certeza que deseja excluir este prompt?')) {
                    this.savedPrompts = this.savedPrompts.filter(p => p.id !== id);
                    localStorage.setItem('costarPrompts', JSON.stringify(this.savedPrompts));
                    this.loadSavedPrompts();
                    this.showAlert('Prompt exclu√≠do com sucesso!', 'success');
                }
            }

            clearForm() {
                if (confirm('Tem certeza que deseja limpar todos os campos?')) {
                    document.getElementById('promptForm').reset();
                    document.getElementById('generatedPrompt').style.display = 'none';
                    this.showAlert('Formul√°rio limpo!', 'success');
                }
            }

            async sendToGemini() {
                try {
                    // Get form data for analysis
                    const formData = {
                        contexto: document.getElementById('context').value.trim(),
                        objetivo: document.getElementById('objective').value.trim(),
                        estilo: document.getElementById('style').value.trim(),
                        tom: document.getElementById('tone').value.trim(),
                        audiencia: document.getElementById('audience').value.trim(),
                        resposta: document.getElementById('response').value.trim()
                    };

                    // Validate form
                    const emptyFields = Object.values(formData).filter(value => !value);
                    if (emptyFields.length > 0) {
                        this.showAlert('Por favor, preencha todos os campos antes de analisar.', 'error');
                        return;
                    }

                    // Show analysis loading
                    const analysisDiv = document.createElement('div');
                    analysisDiv.id = 'analysisResult';
                    analysisDiv.innerHTML = `
                        <div style="margin-top: 30px; padding: 20px; border: 2px solid #007bff; border-radius: 8px; background: #f8f9fa;">
                            <h3 style="margin: 0 0 15px 0; color: #007bff;">
                                <i class="fas fa-robot"></i> An√°lise com IA Gemini
                            </h3>
                            <div style="text-align: center; padding: 20px;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                                <p>Analisando qualidade do prompt...</p>
                            </div>
                        </div>
                    `;

                    // Remove existing analysis and add new one
                    const existing = document.getElementById('analysisResult');
                    if (existing) existing.remove();

                    document.getElementById('generatedPrompt').appendChild(analysisDiv);

                    // Scroll to analysis
                    analysisDiv.scrollIntoView({ behavior: 'smooth' });

                    // Call analysis API
                    const response = await fetch('/api/prompts/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        throw new Error(`Erro na API: ${response.status}`);
                    }

                    const result = await response.json();
                    const analysis = result.analise;

                    // Display analysis results
                    analysisDiv.innerHTML = `
                        <div style="margin-top: 30px; padding: 20px; border: 2px solid #007bff; border-radius: 8px; background: #f8f9fa;">
                            <h3 style="margin: 0 0 15px 0; color: #007bff;">
                                <i class="fas fa-robot"></i> An√°lise com IA Gemini
                            </h3>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 6px;">
                                    <div style="font-size: 28px; font-weight: bold; color: ${analysis.cor === 'verde' ? '#4CAF50' : analysis.cor === 'azul' ? '#2196F3' : analysis.cor === 'amarelo' ? '#FF9800' : '#f44336'};">
                                        ${analysis.pontuacao}/100
                                    </div>
                                    <div style="font-size: 14px; color: #666;">Pontua√ß√£o Geral</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 6px;">
                                    <div style="font-size: 16px; font-weight: bold; color: #333;">${analysis.qualidade}</div>
                                    <div style="font-size: 14px; color: #666;">Qualidade</div>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #333; margin: 0 0 10px 0;">üìä Resumo:</h4>
                                <p style="margin: 0; font-style: italic;">${analysis.resumo}</p>
                            </div>

                            ${analysis.pontos_fortes && analysis.pontos_fortes.length > 0 ? `
                            <div style="margin-bottom: 15px;">
                                <h4 style="color: #4CAF50; margin: 0 0 10px 0;">‚úÖ Pontos Fortes:</h4>
                                <ul style="margin: 0; padding-left: 20px;">
                                    ${analysis.pontos_fortes.map(ponto => `<li>${ponto}</li>`).join('')}
                                </ul>
                            </div>
                            ` : ''}

                            ${analysis.sugestoes && analysis.sugestoes.length > 0 ? `
                            <div style="margin-bottom: 15px;">
                                <h4 style="color: #FF9800; margin: 0 0 10px 0;">üí° Sugest√µes:</h4>
                                <ul style="margin: 0; padding-left: 20px;">
                                    ${analysis.sugestoes.map(sugestao => `<li>${sugestao}</li>`).join('')}
                                </ul>
                            </div>
                            ` : ''}

                            ${analysis.recomendacoes_prioritarias && analysis.recomendacoes_prioritarias.length > 0 ? `
                            <div style="margin-bottom: 15px;">
                                <h4 style="color: #f44336; margin: 0 0 10px 0;">üéØ Recomenda√ß√µes Priorit√°rias:</h4>
                                <ul style="margin: 0; padding-left: 20px;">
                                    ${analysis.recomendacoes_prioritarias.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                            ` : ''}

                            ${analysis.metricas_detalhadas ? `
                            <div style="margin-bottom: 15px;">
                                <h4 style="color: #2196F3; margin: 0 0 10px 0;">üìà M√©tricas Detalhadas:</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                                    <div style="text-align: center; padding: 10px; background: white; border-radius: 4px;">
                                        <div style="font-weight: bold; color: #2196F3;">${analysis.metricas_detalhadas.completude || 0}%</div>
                                        <div style="font-size: 12px;">Completude</div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; background: white; border-radius: 4px;">
                                        <div style="font-weight: bold; color: #4CAF50;">${analysis.metricas_detalhadas.especificidade || 0}%</div>
                                        <div style="font-size: 12px;">Especificidade</div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; background: white; border-radius: 4px;">
                                        <div style="font-weight: bold; color: #FF9800;">${analysis.metricas_detalhadas.coerencia || 0}%</div>
                                        <div style="font-size: 12px;">Coer√™ncia</div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; background: white; border-radius: 4px;">
                                        <div style="font-weight: bold; color: #9C27B0;">${analysis.metricas_detalhadas.acionabilidade || 0}%</div>
                                        <div style="font-size: 12px;">Acionabilidade</div>
                                    </div>
                                </div>
                            </div>
                            ` : ''}

                            <div style="margin-top: 20px; padding: 10px; background: #e3f2fd; border-radius: 4px; font-size: 12px; color: #1976d2;">
                                <strong>Modo:</strong> ${analysis.modo || result.modo}<br>
                                <strong>Analisado em:</strong> ${new Date(result.timestamp).toLocaleString('pt-BR')}
                            </div>
                        </div>
                    `;

                    this.showAlert('An√°lise conclu√≠da com sucesso!', 'success');

                } catch (error) {
                    console.error('Erro ao analisar prompt:', error);

                    const analysisDiv = document.getElementById('analysisResult');
                    if (analysisDiv) {
                        analysisDiv.innerHTML = `
                            <div style="margin-top: 30px; padding: 20px; border: 2px solid #f44336; border-radius: 8px; background: #fff3e0;">
                                <h3 style="margin: 0 0 15px 0; color: #f44336;">
                                    <i class="fas fa-exclamation-triangle"></i> Erro na An√°lise
                                </h3>
                                <p>N√£o foi poss√≠vel analisar o prompt com IA.</p>
                                <p><strong>Erro:</strong> ${error.message}</p>
                                <p><small>Tente novamente ou verifique a configura√ß√£o da API.</small></p>
                            </div>
                        `;
                    }

                    this.showAlert('Erro ao analisar prompt com IA', 'error');
                }
            }

            showAlert(message, type) {
                const existingAlert = document.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }

                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                    ${message}
                `;

                const container = document.querySelector('.main-content');
                container.insertBefore(alertDiv, container.firstChild);

                setTimeout(() => {
                    alertDiv.style.opacity = '0';
                    setTimeout(() => alertDiv.remove(), 300);
                }, 4000);
            }

            // Gemini API Integration (placeholder structure)
            async callGeminiAPI(prompt) {
                try {
                    // TODO: Replace with your actual Gemini API configuration
                    const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY';
                    const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

                    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Erro na API do Gemini');
                    }

                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;

                } catch (error) {
                    console.error('Erro ao chamar Gemini API:', error);
                    throw error;
                }
            }

            // Supabase Integration (placeholder structure)
            async initSupabase() {
                // TODO: Configure Supabase
                /*
                const supabaseUrl = 'YOUR_SUPABASE_URL';
                const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
                this.supabase = supabase.createClient(supabaseUrl, supabaseKey);
                */
            }

            async saveToSupabase(promptData) {
                // TODO: Implement Supabase save
                /*
                try {
                    const { data, error } = await this.supabase
                        .from('prompts')
                        .insert([promptData]);
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Erro ao salvar no Supabase:', error);
                    throw error;
                }
                */
            }

            async loadFromSupabase() {
                // TODO: Implement Supabase load
                /*
                try {
                    const { data, error } = await this.supabase
                        .from('prompts')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Erro ao carregar do Supabase:', error);
                    throw error;
                }
                */
            }
        }

        // Initialize the application
        const app = new COSTARGenerator();

        // Add some smooth animations on scroll
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const parallax = document.querySelector('.header');
            const speed = scrolled * 0.5;

            if (parallax) {
                parallax.style.transform = `translateY(${speed}px)`;
            }
        });

        // Add particle animation background (optional enhancement)
        function createParticles() {
            const particles = document.createElement('div');
            particles.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: -1;
            `;

            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: rgba(255,255,255,0.3);
                    border-radius: 50%;
                    animation: float ${Math.random() * 6 + 4}s linear infinite;
                    left: ${Math.random() * 100}%;
                    animation-delay: ${Math.random() * 6}s;
                `;
                particles.appendChild(particle);
            }

            document.body.appendChild(particles);
        }

        // Add CSS for particle animation
        const particleStyle = document.createElement('style');
        particleStyle.textContent = `
            @keyframes float {
                0% {
                    transform: translateY(100vh) rotate(0deg);
                    opacity: 0;
                }
                10% {
                    opacity: 1;
                }
                90% {
                    opacity: 1;
                }
                100% {
                    transform: translateY(-100vh) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(particleStyle);

        // Initialize particles
        createParticles();

        // Service Worker for offline functionality (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registrado com sucesso:', registration);
                    })
                    .catch((registrationError) => {
                        console.log('Falha no registro do SW:', registrationError);
                    });
            });
        }
    </script>
</body>

</html>